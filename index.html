<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Mastermind: Quantum Challenge</title>
    <style>
        :root {
            --primary-dark: #0a0a1a;
            --secondary-dark: #1a1a2e;
            --accent-purple: #4a1e6b;
            --neon-blue: #00f3ff;
            --neon-green: #00ff9d;
            --neon-yellow: #ffeb3b;
            --neon-red: #ff2a6d;
            --text-light: #ffffff;
            --white: #ffffff;
            --correct-color: #00ff9d;
            --incorrect-color: #ff2a6d;
            --particle-color: rgba(0, 243, 255, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-dark), var(--accent-purple));
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(26, 26, 46, 0.7);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }
        
        .info-item {
            text-align: center;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .score {
            color: var(--neon-yellow);
        }
        
        .level {
            color: var(--neon-green);
        }
        
        .timer {
            color: var(--neon-red);
        }
        
        .question-container {
            background: rgba(26, 26, 46, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            border: 1px solid rgba(0, 243, 255, 0.2);
        }
        
        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.8;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .option {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .option.correct {
            background: var(--correct-color);
            color: #000;
            box-shadow: 0 0 20px var(--correct-color);
            transform: scale(1.02);
        }
        
        .option.incorrect {
            background: var(--incorrect-color);
            color: #fff;
            box-shadow: 0 0 20px var(--incorrect-color);
            transform: scale(1.02);
        }
        
        .auto-timer {
            text-align: center;
            margin: 15px 0;
            font-size: 1.1rem;
            color: var(--neon-blue);
            background: rgba(26, 26, 46, 0.7);
            padding: 10px;
            border-radius: 10px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @media (max-width: 600px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .option {
                padding: 15px;
                min-height: 70px;
            }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    
    <div class="container">
        <header>
            <h1></h1>
        </header>
        
        <div class="game-info">
            <div class="info-item">
                <div class="info-label">امتیاز</div>
                <div class="info-value score" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">مرحله</div>
                <div class="info-value level" id="level">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">زمان باقی‌مانده</div>
                <div class="info-value timer" id="auto-timer">20</div>
            </div>
        </div>
        
        <div class="auto-timer">
            <div id="timer-text">سوال بعدی در <span id="countdown">20</span> ثانیه</div>
        </div>
        
        <div class="question-container">
            <div class="question-text" id="question-text">سوال در حال بارگذاری...</div>
            <div class="options-container">
                <div class="option" data-option="1">
                    <span id="option-1-text">گزینه ۱</span>
                </div>
                <div class="option" data-option="2">
                    <span id="option-2-text">گزینه ۲</span>
                </div>
                <div class="option" data-option="3">
                    <span id="option-3-text">گزینه ۳</span>
                </div>
                <div class="option" data-option="4">
                    <span id="option-4-text">گزینه ۴</span>
                </div>
            </div>
        </div>
    </div>

    <!-- عناصر صوتی -->
    <audio id="correct-sound" src="m1.wav" preload="auto"></audio>
    <audio id="incorrect-sound" src="m1.mp3" preload="auto"></audio>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // تنظیمات ذرات پس‌زمینه
        particlesJS("particles-js", {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: "#00f3ff" },
                shape: { type: "circle" },
                opacity: { value: 0.3, random: true },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#00f3ff",
                    opacity: 0.2,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: "none",
                    random: true,
                    straight: false,
                    out_mode: "out",
                    bounce: false
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" },
                    resize: true
                }
            }
        });

        // متغیرهای بازی
        let score = 0;
        let level = 1;
        let autoTimer = 20;
        let currentQuestion = {};
        let selectedOption = null;
        let autoTimerInterval;
        let questionsAnswered = 0;
        let isAnswered = false;
        let usedQuestions = new Set();

        // عناصر DOM
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');
        const autoTimerElement = document.getElementById('auto-timer');
        const countdownElement = document.getElementById('countdown');
        const questionTextElement = document.getElementById('question-text');
        const option1Element = document.getElementById('option-1-text');
        const option2Element = document.getElementById('option-2-text');
        const option3Element = document.getElementById('option-3-text');
        const option4Element = document.getElementById('option-4-text');
        const optionElements = document.querySelectorAll('.option');
        const correctSound = document.getElementById('correct-sound');
        const incorrectSound = document.getElementById('incorrect-sound');

        // تابع تولید سوالات ریاضی پیشرفته
        function generateMathQuestion() {
            const questionTypes = [
                generateLogQuestion,
                generateAlgebraQuestion,
                generateProbabilityQuestion,
                generateTrigonometryQuestion,
                generateExponentQuestion,
                generateIntegralQuestion,
                generateMatrixQuestion,
                generateComplexQuestion
            ];
            
            let newQuestion;
            let attempts = 0;
            
            // جلوگیری از سوال تکراری
            do {
                const randomType = Math.floor(Math.random() * questionTypes.length);
                newQuestion = questionTypes[randomType]();
                attempts++;
                
                // اگر بعد از 10 بار نتوانستیم سوال جدید تولید کنیم، از شرط خارج می‌شویم
                if (attempts > 10) {
                    usedQuestions.clear();
                    break;
                }
            } while (usedQuestions.has(newQuestion.question));
            
            usedQuestions.add(newQuestion.question);
            return newQuestion;
        }

        // تولید سوال لگاریتم
        function generateLogQuestion() {
            const base = Math.floor(Math.random() * 3) + 2;
            const value = Math.pow(base, Math.floor(Math.random() * 3) + 2);
            const extra = Math.floor(Math.random() * 10) + 5;
            
            const question = `حاصل عبارت log${base}(${value}) + ${extra} کدام است؟`;
            const correct = Math.log(value) / Math.log(base) + extra;
            
            const options = generateOptions(correct, 5);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString()) + 1,
                explanation: `log${base}(${value}) = ${Math.log(value) / Math.log(base)}, ${Math.log(value) / Math.log(base)} + ${extra} = ${correct}`
            };
        }

        // تولید سوال جبر
        function generateAlgebraQuestion() {
            const x = Math.floor(Math.random() * 5) + 2;
            const a = Math.floor(Math.random() * 5) + 1;
            const b = Math.floor(Math.random() * 5) + 1;
            
            const question = `اگر x = ${x} باشد، حاصل (${a}x² - ${b}) / (x - 1) کدام است؟`;
            const correct = (a * x * x - b) / (x - 1);
            
            const options = generateOptions(correct, 3);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString()) + 1,
                explanation: `(${a}*${x}² - ${b}) / (${x} - 1) = (${a*x*x} - ${b}) / ${x-1} = ${a*x*x - b} / ${x-1} = ${correct}`
            };
        }

        // تولید سوال احتمال
        function generateProbabilityQuestion() {
            const total = Math.floor(Math.random() * 6) + 5;
            const favorable = Math.floor(Math.random() * (total - 2)) + 2;
            
            const question = `در یک مجموعه شامل ${total} عدد، اگر یک عدد به تصادف انتخاب شود، احتمال بخش‌پذیر بودن آن بر ${favorable} چقدر است؟`;
            const correct = Math.floor(total / favorable) / total * 100;
            
            const options = generateOptions(correct, 10, true);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString() + "%") + 1,
                explanation: `اعداد بخش‌پذیر بر ${favorable} در مجموعه: ${Math.floor(total/favorable)} عدد, احتمال: ${Math.floor(total/favorable)}/${total} = ${correct}%`
            };
        }

        // تولید سوال مثلثات
        function generateTrigonometryQuestion() {
            const angle = [30, 45, 60][Math.floor(Math.random() * 3)];
            const hypotenuse = Math.floor(Math.random() * 5) * 5 + 10;
            
            let correct, sideType;
            if (angle === 30) {
                correct = hypotenuse * 0.5;
                sideType = "ضلع مقابل";
            } else if (angle === 45) {
                correct = hypotenuse * Math.sqrt(2) / 2;
                sideType = "هر یک از اضلاع";
            } else {
                correct = hypotenuse * Math.sqrt(3) / 2;
                sideType = "ضلع مجاور";
            }
            
            const question = `در یک مثلث قائم‌الزاویه، اگر وتر ${hypotenuse} و یکی از زاویه‌ها ${angle} درجه باشد، طول ${sideType} چقدر است؟`;
            
            const options = generateOptions(correct, 2);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString()) + 1,
                explanation: `مقدار مثلثاتی زاویه ${angle} درجه: ${sideType === "ضلع مقابل" ? "سینوس" : sideType === "ضلع مجاور" ? "کسینوس" : "سینوس/کسینوس"} = ${correct/hypotenuse}`
            };
        }

        // تولید سوال توان
        function generateExponentQuestion() {
            const a = Math.floor(Math.random() * 3) + 2;
            const b = Math.floor(Math.random() * 3) + 2;
            const c = Math.floor(Math.random() * 3) + 2;
            
            const question = `حاصل عبارت ${a}² × ${b}³ ÷ ${c}² کدام است؟`;
            const correct = (a*a * b*b*b) / (c*c);
            
            const options = generateOptions(correct, 5);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString()) + 1,
                explanation: `${a}² = ${a*a}, ${b}³ = ${b*b*b}, ${a*a} × ${b*b*b} = ${a*a*b*b*b}, ${a*a*b*b*b} ÷ ${c*c} = ${correct}`
            };
        }

        // تولید سوال انتگرال
        function generateIntegralQuestion() {
            const a = Math.floor(Math.random() * 3) + 1;
            const from = Math.floor(Math.random() * 3);
            const to = Math.floor(Math.random() * 3) + 3;
            
            const question = `حاصل انتگرال ∫(${a}x)dx از ${from} تا ${to} کدام است؟`;
            const correct = 0.5 * a * (to*to - from*from);
            
            const options = generateOptions(correct, 2);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString()) + 1,
                explanation: `پادمشتق ${a}x برابر ${a/2}x² است. مقدار در ${to}: ${0.5*a*to*to}, مقدار در ${from}: ${0.5*a*from*from}, حاصل: ${0.5*a*to*to} - ${0.5*a*from*from} = ${correct}`
            };
        }

        // تولید سوال ماتریس
        function generateMatrixQuestion() {
            const a = Math.floor(Math.random() * 3) + 1;
            const b = Math.floor(Math.random() * 3) + 1;
            const c = Math.floor(Math.random() * 3) + 1;
            const d = Math.floor(Math.random() * 3) + 1;
            
            const question = `اگر ماتریس A = [[${a},${b}],[${c},${d}]] باشد، دترمینان آن چقدر است؟`;
            const correct = a*d - b*c;
            
            const options = generateOptions(correct, 2);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString()) + 1,
                explanation: `دترمینان ماتریس 2x2: (${a}×${d}) - (${b}×${c}) = ${a*d} - ${b*c} = ${correct}`
            };
        }

        // تولید سوال ترکیبی پیچیده
        function generateComplexQuestion() {
            const a = Math.floor(Math.random() * 3) + 2;
            const b = Math.floor(Math.random() * 3) + 2;
            const c = Math.floor(Math.random() * 3) + 1;
            
            const question = `حاصل عبارت (${a}² + ${b}²) × √${c*9} کدام است؟`;
            const correct = (a*a + b*b) * 3 * Math.sqrt(c);
            
            const options = generateOptions(correct, 5);
            
            return {
                question: question,
                options: options,
                correct: options.indexOf(correct.toString()) + 1,
                explanation: `${a}² = ${a*a}, ${b}² = ${b*b}, ${a*a} + ${b*b} = ${a*a+b*b}, √${c*9} = 3√${c}, ${a*a+b*b} × 3√${c} = ${correct}`
            };
        }

        // تولید گزینه‌ها
        function generateOptions(correct, range, isPercentage = false) {
            const options = [];
            const correctIndex = Math.floor(Math.random() * 4);
            
            for (let i = 0; i < 4; i++) {
                if (i === correctIndex) {
                    options.push(isPercentage ? correct.toString() + "%" : correct.toString());
                } else {
                    let wrongValue;
                    do {
                        wrongValue = correct + (Math.floor(Math.random() * range * 2) - range);
                        if (wrongValue === correct) wrongValue += 1;
                    } while (options.includes(isPercentage ? wrongValue.toString() + "%" : wrongValue.toString()));
                    
                    options.push(isPercentage ? wrongValue.toString() + "%" : wrongValue.toString());
                }
            }
            
            return options;
        }

        // شروع بازی
        function initGame() {
            score = 0;
            level = 1;
            questionsAnswered = 0;
            usedQuestions.clear();
            updateUI();
            loadQuestion();
            startAutoTimer();
        }

        // بارگذاری سوال جدید
        function loadQuestion() {
            // تولید سوال جدید
            currentQuestion = generateMathQuestion();
            
            // نمایش سوال و گزینه‌ها
            questionTextElement.textContent = currentQuestion.question;
            option1Element.textContent = currentQuestion.options[0];
            option2Element.textContent = currentQuestion.options[1];
            option3Element.textContent = currentQuestion.options[2];
            option4Element.textContent = currentQuestion.options[3];
            
            // ریست کردن انتخاب‌ها و رنگ‌ها
            selectedOption = null;
            isAnswered = false;
            optionElements.forEach(option => {
                option.classList.remove('correct', 'incorrect');
                option.style.background = 'rgba(255, 255, 255, 0.9)';
                option.style.color = '#333';
            });
            
            // ریست تایمر خودکار
            resetAutoTimer();
        }

        // به‌روزرسانی UI
        function updateUI() {
            scoreElement.textContent = score;
            levelElement.textContent = level;
            autoTimerElement.textContent = autoTimer;
            countdownElement.textContent = autoTimer;
        }

        // شروع تایمر خودکار
        function startAutoTimer() {
            clearInterval(autoTimerInterval);
            autoTimerInterval = setInterval(() => {
                autoTimer--;
                autoTimerElement.textContent = autoTimer;
                countdownElement.textContent = autoTimer;
                
                if (autoTimer <= 0) {
                    clearInterval(autoTimerInterval);
                    nextQuestion();
                }
            }, 1000);
        }

        // ریست تایمر خودکار
        function resetAutoTimer() {
            autoTimer = 20;
            autoTimerElement.textContent = autoTimer;
            countdownElement.textContent = autoTimer;
        }

        // رفتن به سوال بعدی
        function nextQuestion() {
            questionsAnswered++;
            
            // بررسی ارتقاء سطح
            if (questionsAnswered % 5 === 0) {
                level++;
            }
            
            updateUI();
            loadQuestion();
            startAutoTimer();
        }

        // بررسی پاسخ
        function checkAnswer(selected) {
            if (isAnswered) return;
            
            isAnswered = true;
            const isCorrect = parseInt(selected.dataset.option) === currentQuestion.correct;
            
            // نمایش پاسخ صحیح و ناصحیح
            optionElements.forEach(option => {
                if (parseInt(option.dataset.option) === currentQuestion.correct) {
                    option.classList.add('correct');
                } else if (option === selected && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
            
            // پخش صدا
            if (isCorrect) {
                correctSound.play();
                score += level * 10;
            } else {
                incorrectSound.play();
            }
            
            updateUI();
            
            // رفتن به سوال بعدی پس از 2 ثانیه
            clearInterval(autoTimerInterval);
            setTimeout(nextQuestion, 2000);
        }

        // مدیریت رویدادها
        optionElements.forEach(option => {
            option.addEventListener('click', () => {
                if (isAnswered) return;
                checkAnswer(option);
            });
        });

        // شروع بازی
        initGame();
    </script>
</body>
</html>
